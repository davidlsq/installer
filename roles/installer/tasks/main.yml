# Install package

- name: Package
  ansible.builtin.apt:
    name:
      - git
      - rsync
      - python3
      - python3-venv
    state: present

# Create lib

- name: Create venv
  ansible.builtin.pip:
    name: ansible
    virtualenv: '{{ installer_venv }}'
    virtualenv_command: python3 -m venv
    virtualenv_site_packages: true
    umask: '0077'

- name: Create lib dir
  ansible.builtin.file:
    path: '{{ installer_lib }}'
    state: directory
    owner: root
    group: root
    mode: u=rwx,go=

- name: Copy files
  with_items:
    - 'files/{{ installer_host }}/'
    - 'host_vars/{{ installer_host }}/'
    - 'group_vars/'
  ansible.builtin.copy:
    src: '{{ item }}'
    dest: '{{ installer_lib }}/archive/{{ item }}/'
    owner: root
    group: root
    mode: u=rw,go=
    directory_mode: u=rx,go=

- name: Create script
  ansible.builtin.template:
    src: run.sh.j2
    dest: '{{ installer_lib }}/run.sh'
    owner: root
    group: root
    mode: u=rwx,go=

# Create var

- name: Create var dir
  ansible.builtin.file:
    path: '{{ installer_var }}'
    state: directory
    owner: root
    group: root
    mode: u=rwx,go=
